# Changelog

## [v1.26.0] - 2025-11-30

### üö® Breaking Changes

- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `Ch`**: –î–æ–±–∞–≤–ª–µ–Ω—ã –∞—Ç–æ–º–∞—Ä–Ω—ã–µ —Ñ–ª–∞–≥–∏ `txClosed` –∏ `rxClosed` —Ç–∏–ø–∞ `atomic.Bool`
- **–¢–∏–ø `map[uint64]Ch`**: –ò–∑–º–µ–Ω–µ–Ω –Ω–∞ `map[uint64]*Ch` –≤ `RespModel.Chan` –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è lock
- **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å `Model.GetCh`**: –í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π —Ç–∏–ø –∏–∑–º–µ–Ω–µ–Ω —Å `(Ch, error)` –Ω–∞ `(*Ch, error)`
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `StartCh`**: –ü–æ–ª–µ `Chanel` –∏–∑–º–µ–Ω–µ–Ω–æ —Å `Ch` –Ω–∞ `*Ch`

### ‚ú® –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

#### –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç—ã —Å –∫–∞–Ω–∞–ª–∞–º–∏ –≤ `Ch`:
- `IsTxOpen() bool` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–∞–Ω–∞–ª–∞ TxCh
- `IsRxOpen() bool` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–∞–Ω–∞–ª–∞ RxCh
- `SendToTx(msg Message) error` - –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ TxCh —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –ø–∞–Ω–∏–∫–∏
- `SendToRx(msg Message) error` - –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ RxCh —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –ø–∞–Ω–∏–∫–∏
- `Close() error` - graceful –∑–∞–∫—Ä—ã—Ç–∏–µ –æ–±–æ–∏—Ö –∫–∞–Ω–∞–ª–æ–≤

#### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è Listener ‚Üî Respondent:
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `respondentWG sync.Map` –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É `Start`
- `Listener` —Ç–µ–ø–µ—Ä—å –æ–∂–∏–¥–∞–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è `Respondent` –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –∫–∞–Ω–∞–ª–æ–≤ (—Å —Ç–∞–π–º–∞—É—Ç–æ–º 5 —Å–µ–∫)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `sync.WaitGroup` –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≥–æ—Ä—É—Ç–∏–Ω

### üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

#### pkg/model/model.go:
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ race condition –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –∫–∞–Ω–∞–ª–æ–≤ –≤ `CleanDialogData`
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ race condition –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –∫–∞–Ω–∞–ª–æ–≤ –≤ `cleanupAllResponders`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–ª–∞–≥–æ–≤ `txClosed`/`rxClosed` –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º `safeClose`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ 10ms –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ lock –ø—Ä–∏ –∏—Ç–µ—Ä–∞—Ü–∏–∏ `range` –ø–æ `map[uint64]*Ch`

#### pkg/startpoint/startpoint.go:
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ `defer recover` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ `answerCh`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ `defer recover` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ `questionCh` —Å —Ç–∞–π–º–∞—É—Ç–æ–º 100ms
- ‚úÖ –ó–∞–º–µ–Ω–µ–Ω–∞ –ø—Ä—è–º–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ `usrCh.TxCh` –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –º–µ—Ç–æ–¥ `SendToTx` —Å —Ñ–æ–ª–±—ç–∫–æ–º
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ `fmt.Errorf` –¥–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ —Ç–∏–ø–∞ —Å–æ–æ–±—â–µ–Ω–∏—è

### üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω—ã unit-—Ç–µ—Å—Ç—ã –≤ `pkg/model/model_test.go`:
- `TestSafeClose` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è
- `TestChSendToRxConcurrent` - —Ç–µ—Å—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ (100 –≥–æ—Ä—É—Ç–∏–Ω)
- `TestChCloseWhileSending` - —Ç–µ—Å—Ç –∑–∞–∫—Ä—ã—Ç–∏—è –∫–∞–Ω–∞–ª–∞ –≤–æ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ (1000 –æ–ø–µ—Ä–∞—Ü–∏–π)
- `TestChIsOpenFlags` - —Ç–µ—Å—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Ñ–ª–∞–≥–æ–≤ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- `TestChSendToTx` - —Ç–µ—Å—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ TxCh
- `BenchmarkChSendToRx` - –±–µ–Ω—á–º–∞—Ä–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (127 ns/op)
- `BenchmarkDirectChannelSend` - –±–µ–Ω—á–º–∞—Ä–∫ –ø—Ä—è–º–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è (84 ns/op)

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**:
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –æ–≤–µ—Ä—Ö–µ–¥ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ ~50% (43 ns), —á—Ç–æ –ø—Ä–∏–µ–º–ª–µ–º–æ
- ‚ö†Ô∏è Race detector —Ç—Ä–µ–±—É–µ—Ç gcc (–Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –≤ Windows –æ–∫—Ä—É–∂–µ–Ω–∏–∏)

### üìä –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```
BenchmarkChSendToRx-20          25988744    127.2 ns/op    12 B/op    0 allocs/op
BenchmarkDirectChannelSend-20   39872584     84.15 ns/op    0 B/op    0 allocs/op
```

**–û–≤–µ—Ä—Ö–µ–¥ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤**: ~51% (–ø—Ä–∏–µ–º–ª–µ–º–æ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –∑–∞—â–∏—Ç—ã)

### üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –∫–æ–¥–∞

#### –°—Ç–∞—Ä—ã–π –∫–æ–¥ (–û–ü–ê–°–ù–û):
```go
usrCh.RxCh <- userMessage
```

#### –ù–æ–≤—ã–π –∫–æ–¥ (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø):
```go
if err := usrCh.SendToRx(userMessage); err != nil {
    logger.Error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: %v", err)
    // –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—à–∏–±–∫—É –∏–ª–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∫–∞–Ω–∞–ª—ã
}
```

#### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ (–æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å):
```go
defer func() {
    if r := recover(); r != nil {
        logger.Error("–ü–∞–Ω–∏–∫–∞: %v", r)
    }
}()
usrCh.RxCh <- userMessage
```

### üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –°—Ç–∞—Ä—ã–π –∫–æ–¥ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –Ω–æ –±—É–¥–µ—Ç –ø–æ–¥–≤–µ—Ä–∂–µ–Ω race conditions
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –Ω–æ–≤—ã–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –º–µ—Ç–æ–¥—ã
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –§–∞–π–ª—ã `LIBRARY_PATCH.go` –∏ `LIBRARY_TESTS_EXAMPLE.go` –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω—ã –≤ `.txt`

### üéØ –¶–µ–ª–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

–≠—Ç–∞ –≤–µ—Ä—Å–∏—è —É—Å—Ç—Ä–∞–Ω—è–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–æ–±–ª–µ–º—É:
```
panic: send on closed channel
goroutine 1552 [running]:
github.com/ikermy/AiR_Common/pkg/startpoint.(*Start).Respondent(...)
```

### üë• –ê–≤—Ç–æ—Ä—ã

- –û—Å–Ω–æ–≤–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞: GitHub Copilot & Development Team
- –î–∞—Ç–∞ —Ä–µ–ª–∏–∑–∞: 2025-11-30

---

## [v1.25.9] - Previous version

–ü—Ä–µ–¥—ã–¥—É—â–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –±–µ–∑ –∑–∞—â–∏—Ç—ã –æ—Ç race conditions.

